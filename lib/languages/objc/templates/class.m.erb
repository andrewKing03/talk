<%= autogenerated_warning %>
#define __CANONFILE__ "<%= truncated_name(@current_class) %>"
#import "TalkObjectList.h"
#import "TalkObject+Private.h"

#if ! __has_feature(objc_arc)
#error This file requires Automatic Reference Counting
#endif

@implementation <%= truncated_name(@current_class) %>
<%= dynamic_body_for_named_wrapper %>
<% unless trimmed_fields(@current_class).empty? then %>
@synthesize <%= (trimmed_fields(@current_class).map { |f| mapped_name(@current_class, f[:name], :field) }).join(', ') %>;
<% end %>

<% unless class_field_maps(@current_class).empty? then %>
-(void) initKeymaps
{
  [super initKeymaps];
<% class_field_maps(@current_class).each do |map| %>
  [self mapSerializedKey:@"<%= map[:field_name] %>" toLocalKey:@"<%= map[:new_field_name] %>"];
<% end %>
}

-(BOOL) needsKeymapping
{
  return YES;
}
<% end %>

<% unless (@current_class[:field].reject { |f| assist_line(f).nil? }).length == 0 then %>
-(NSDictionary *) containerStructure
{
  NSDictionary *local = @{
<%
    @current_class[:field].each do |field|
      assist = assist_line(field)
      next if assist.nil?
%>    @"<%= mapped_name(@current_class, field[:name], :field) %>": <%= assist %>,
<%  end %>
  };

  NSMutableDictionary *merged = [[super containerStructure] mutableCopy];
  [merged addEntriesFromDictionary:local];
  return merged;
}
<% end %>
+(NSString *) fullyQualifiedClassName
{
  return @"<%= @current_class[:name] %>";
}

@end
